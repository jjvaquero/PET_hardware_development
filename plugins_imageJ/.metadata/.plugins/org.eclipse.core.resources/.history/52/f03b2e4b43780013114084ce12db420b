import ij.IJ;
import ij.gui.Roi;
import ij.ImagePlus;
import ij.process.ImageProcessor;
import ij.io.*;
import ij.plugin.*;
import ij.process.ImageStatistics;
import ij.measure.Calibration;
import ij.measure.Measurements;


public class nimiMapa_1 implements PlugIn {
	ImagePlus img;
	ImageProcessor myProc;

	//public int setup(String arg, ImagePlus imp) {
		
    public void run(String arg) {
		//first I will try to open the new miniMap image
		ImportDialog impDiag = new ImportDialog("minimap.raw","C:/Users/rchil/Desktop/Detect_SuperArgus/datos_16_12_13");
		FileInfo fInf = impDiag.getFileInfo();
		OpenDialog myDiag= new OpenDialog("Dialogo 1");
		fInf.fileName = myDiag.getFileName();		
		fInf.directory = myDiag.getDirectory();
		FileOpener fOpen = new FileOpener(fInf);
		
		img = fOpen.open(true);
		myProc = img.getProcessor();

		//myProc = img.getProcessor();

		//this.imp = imp;
		//modify later to use only 16 bits images
	//}
	
	//public void run(ImageProcessor ip) {
		int sizeX = 24; 
		int sizeY = 12;
		ImageProcessor tmpProc; 
		ImageStatistics nStats = new ImageStatistics();
		Calibration nCal = new Calibration();
		double[]  means = new double[sizeX*sizeY];
		double[] stdDevs = new double[sizeX*sizeY];
		Roi [] rois = new Roi[sizeX*sizeY];
		int index = 0;
		
		for(int x = 0; x < 10 ; x++){
			for (int y = 0; y<10; y++){
				myProc.putPixel(x,y,0);
			}
		}
		img.updateAndDraw();
		
		
		for (int x = 0; x <sizeX; x++){
			for ( int y = 0; y < sizeY; y++){
				rois[index] = new Roi(x*14,y*14,12,12);
				myProc.setRoi(rois[index]);

				tmpProc = myProc.crop();
				nStats = ImageStatistics.getStatistics(tmpProc, Measurements.MEAN+Measurements.STD_DEV,nCal); //6 = MEAN + STD_DEV
				means[index] = nStats.umean;
				stdDevs[index] = nStats.stdDev;
				myProc.draw(rois[index]);
				index++;		
				IJ.log("Cristal "+ String.valueOf(index-1)+ " media "+ String.valueOf(means[index-1]));
				myProc.resetRoi();
				}			

		}
		
		IJ.showStatus("Start processing...");
		IJ.wait(200);
		int height = myProc.getHeight();
		int width = myProc.getWidth();
		for (int x = 0; x < width; x++) {
			for(int y = 0; y < height; y++) {
				if (x ==y){
					myProc.putPixel(x, y, 0);
				}
				//if ((x == width/2) && (y == height/2)){
				//   int val = myProc.getPixel(x, y);
				   
				//}

			}
		}
		img.updateAndDraw();
	}
    
}